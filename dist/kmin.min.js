async function impComp(t){try{var n=await fetch(t);if(!n.ok)throw new Error("Failed to fetch component: "+n.statusText);var r=await n.text(),o=(new DOMParser).parseFromString(r,"text/html"),s=r.match(/<template>([\s\S]*?)<\/template>/)[1];let e=o.querySelector("script").innerHTML;e=e.replace(/\s*extends\s*KMin\s*{/g,` extends KMin { css() { return \`${o.querySelector("style").innerHTML}\`; } render() { return \`${s}\`; } `);var a=document.createElement("script");a.type="module",a.textContent=e,document.head.appendChild(a)}catch(e){console.error(e)}}class KMin extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"});var e=new CSSStyleSheet;e.replaceSync(this.css()),this.shadowRoot.adoptedStyleSheets=[e],this.eventListeners=[]}state(e){const o=this;return new Proxy(e,{get(e,t,n){e=Reflect.get(e,t,n);return"object"==typeof e&&null!==e?o.state(e):e},set(e,t,n,r){return Reflect.set(e,t,n,r),o.updateComponent(),!0}})}updateComponent(){var e=this.render();this.#_processTemplate(e)}#_processTemplate(e){this.#diff(this.shadowRoot.childNodes,parseHTML(this.#tpl(e))),this.shadowRoot.querySelectorAll("[data-event]").forEach(t=>{const n=t.getAttribute("data-event").split(",");t.removeAttribute("data-event"),this.eventListeners.find(e=>e.element===t&&e.type===n[0])||(this.eventListeners.push({element:t,type:n[0],handler:n[1]}),t.addEventListener(n[0],()=>{this[n[1]]&&this[n[1]].call(this,t)}))})}connectedCallback(){this.updateComponent()}#tpl(e){e=`let km_tpl = \`${e=e.replace(/\{\#if\s+([^}]*)\}/g,(e,t)=>"`;if("+kmComparison(t)+") {km_tpl+=`").replace(/\{\#else\s+if\s+([^}]*)\}/g,(e,t)=>"`;} else if("+kmComparison(t)+") {km_tpl+=`").replace(/\{\#else\}/g,"`;} else {km_tpl+=`").replace(/\{\/if\}/g,"`;}km_tpl+=`").replace(/\{\#for\s+([^}]*)}/g,(e,t)=>"`;for("+kmComparison(t)+") {km_tpl+=`").replace(/\{\/for\}/g,"`;}km_tpl+=`").replace(/\{\#each\s+([^}]+)\s+as\s+([^}]+)}/g,"`;$1.forEach(function($2){km_tpl+=`").replace(/\{\/each\}/g,"`;});km_tpl+=`").replace(/\{\{([^}]*)\}\}/g,"${kmHtml($1)}").replace(/\{\#html\s+([^}]*)\}/g,"${kmHtml($1,false)}").replace(/@([a-z]+)="([\w$]+)"/g,(e,t,n)=>`data-event="${t},${n}"`)}\`; return km_tpl;`;try{var t=Object.keys(this);return t.push("kmHtml"),new Function(...t,e)(...t.map(e=>this[e]))}catch(e){throw new Error("Template error, "+e.message)}}kmHtml(t,e=!0){if(null==t)return"";if("function"==typeof t)return kmHtml(t());if(Array.isArray(t)){var n=t.length,r=new Array(n);for(let e=0;e<n;e++)r[e]=kmHtml(t[e]);return r.join(",")}var o=String(t);if(!e)return o;const s={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};e=/[&<>"']/g;return e.test(o)?o.replace(e,e=>s[e]):o}#diff(t,n){for(let e=0;e<t.length;e++){var r=t[e],o=n[e];if(o)if(3===r.nodeType||3===o.nodeType)r.nodeValue!==o.nodeValue&&(r.nodeValue=o.nodeValue);else if(r.nodeName!==o.nodeName)r.outerHTML=o.outerHTML;else{var s=r.attributes,a=o.attributes;if(void 0!==s)for(let e=0;e<s.length;e++){var l=s[e],i=a[e];a[e]?(l.name!==i.name&&r.setAttribute(l.name,i.value),l.value!==i.value&&r.setAttribute(l.name,i.value)):r.removeAttribute(l.name)}if(void 0!==a)for(let e=0;e<a.length;e++){var c=a[e];s[e]||r.setAttribute(c.name,c.value)}this.#diff(r.childNodes,o.childNodes)}else r.removeChild(r.children[e])}if(n.length>t.length)for(let e=t.length;e<n.length;e++)(t[0]?t[0].parentNode:this.shadowRoot).appendChild(n[e].cloneNode(!0))}css(){return""}render(){return""}disconnectedCallback(){}adoptedCallback(){}attributeChangedCallback(e,t,n){}}function kmComparison(e){const t={eq:"==",neq:"!=",gt:">",egt:">=",lt:"<",elt:"<=",heq:"===",nheq:"!=="};var n=Object.keys(t).sort((e,t)=>t.length-e.length).map(e=>e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")).join("|"),n=new RegExp(`\\b(${n})\\b`,"g");return e.replace(n,e=>t[e])}function parseHTML(e){var t=document.createElement("div");return t.innerHTML=e,t.childNodes}class Event{constructor(e){this.component=e,this.Components=new Map,this.eventListeners=new Map}register(e,t){t="string"==typeof t?(this.component.shadowRoot||this.component).querySelector(t):t;return!!t&&(this.Components.set(e,t),!0)}call(t,n,...e){var r=this.Components.get(t);if(r){var o=r[n];if("function"!=typeof o)console.warn(`Method "${n}" not found in "${t}"`);else try{return o.apply(r,e)}catch(e){console.error(`Error calling "${n}" on "${t}":`,e)}}else console.warn(`Component "${t}" not registered`);return null}on(e,t,n){var r=this.Components.get(e);if(!r)return console.warn(`listen event failed, component "${e}" not register`);this.eventListeners.set(e+"-"+t,{child:r,eventName:t,handler:n}),r.addEventListener(t,n)}off(e,t){e=e+"-"+t,t=this.eventListeners.get(e);t&&(t.child.removeEventListener(t.eventName,t.handler),this.eventListeners.delete(e))}emit(e,t){this.component.dispatchEvent(new CustomEvent(e,{detail:t,bubbles:!0,composed:!0}))}destroy(){this.eventListeners.forEach(({child:e,eventName:t,handler:n})=>{e.removeEventListener(t,n)}),this.Components.clear(),this.eventListeners.clear()}}"undefined"!=typeof window&&(window.KMin=KMin,window.impComp=impComp,window.Event=Event);export{impComp,KMin,Event};