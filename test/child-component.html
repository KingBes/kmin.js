<template>
    <div class="child-container">
        <h3>子组件</h3>
        <p>当前值: {{ count.value }}</p>
        <button @click="selfIncrement">子组件内部增加</button>
    </div>
</template>

<style>
    .child-container {
        border: 1px solid #ccc;
        padding: 10px;
        margin: 10px 0;
    }

    button {
        margin-top: 10px;
        padding: 4px 8px;
    }
</style>

<script type="module">
    import { KMin } from '../src/kmin.js';
    customElements.define('child-component', class extends KMin {
        constructor() {
            super();
            // 初始化状态（响应式）
            this.count = this.state({ value: 0 });
            this.event = new Event(this); // 事件派发
        }

        // 子组件内部方法：自增
        selfIncrement() {
            this.count.value++;
            // 触发事件通知父组件（内部操作导致的变化）
            this.event.emit('count-changed', {
                value: this.count.value,
                source: 'child'
            });
        }

        // 供父组件调用的方法：重置值
        resetValue(newValue) {
            this.count.value = newValue;
            // 触发事件通知父组件（父组件调用导致的变化）
            this.event.emit('count-changed', {
                value: this.count.value,
                source: 'parent'
            });
        }

        
        // 清理资源
        disconnectedCallback() {
            // 移除事件监听
            this.event.destroy();
        }
    });
</script>